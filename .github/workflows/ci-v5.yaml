name: ScottPlot5

on:
  workflow_dispatch:
  push: # only runs on commits to main branch (typically after a merge)
    branches:
      - main
    paths:
      - "src/ScottPlot5/**"
  pull_request: # runs on commits to pull request branches
    paths:
      - "src/ScottPlot5/**"

jobs:
  # format:
  #   runs-on: windows-latest
  #   name: Check Formatting
  #   steps:
  #     - name: üõí Checkout
  #       uses: actions/checkout@v3
  #     - name: ‚ú® Set up .NET 6.0
  #       uses: actions/setup-dotnet@v3
  #       with:
  #         dotnet-version: "6.0.x"
  #     - name: ‚úíÔ∏è Set up dotnet-format
  #       run: dotnet tool install -g dotnet-format
  #     - name: üßê Check Code Format
  #       working-directory: src/ScottPlot5
  #       run: dotnet-format --check
  #     - name: ‚ö†Ô∏è Check for Warnings
  #       run: dotnet build "src/ScottPlot5/ScottPlot5" --configuration Release -warnaserror -nowarn:CS2002

  test4:
    strategy:
      fail-fast: false
      matrix:
        include:
          #- os: ubuntu-latest
            #osName: Linux
          - os: windows-latest
            osName: Windows
          #- os: macos-latest
            #osName: MacOS
    runs-on: ${{ matrix.os }}
    name: Test on ${{ matrix.osName }}
    steps:
      - name: üõí Checkout
        uses: actions/checkout@v3
      - name: ‚ú® Setup .NET 6.0
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: "6.0.x"

      - name: üöö Restore
        run: |
          dotnet restore "src/ScottPlot5/ScottPlot5 Tests"
          dotnet restore "src/ScottPlot5/ScottPlot5 Cookbook"
      - name: üõ†Ô∏è Build
        run: |
          dotnet build "src/ScottPlot5/ScottPlot5 Tests" --configuration Release --no-restore
          dotnet build "src/ScottPlot5/ScottPlot5 Cookbook" --configuration Release --no-restore
      - name: üì¶ Pack
        run: |
          dotnet pack "src/ScottPlot5/ScottPlot5" --configuration Release
          dotnet pack "src/ScottPlot5/ScottPlot5 Controls/ScottPlot.WinForms" --configuration Release
          dotnet pack "src/ScottPlot5/ScottPlot5 Controls/ScottPlot.WPF" --configuration Release
          dotnet pack "src/ScottPlot5/ScottPlot5 Controls/ScottPlot.Avalonia" --configuration Release
          dotnet pack "src/ScottPlot5/ScottPlot5 Controls/ScottPlot.Eto" --configuration Release
      - name: üß™ Test
        run: dotnet test "src/ScottPlot5/ScottPlot5 Tests" --no-restore --verbosity minimal
      - name: üßë‚Äçüç≥ Cookbook
        run: dotnet test "src/ScottPlot5/ScottPlot5 Cookbook" --no-restore --verbosity minimal

      # msbuild is required to build a solution containing .NET Framework projects
      - name: üê¢ Setup MSBuild
        if: startsWith(matrix.os, 'windows')
        uses: microsoft/setup-msbuild@v1.1
      - name: üöö Restore Solution
        if: startsWith(matrix.os, 'windows')
        run: dotnet restore src/ScottPlot5
      - name: üêå Build Solution
        if: startsWith(matrix.os, 'windows')
        run: msbuild src/ScottPlot5 -property:Configuration=Release -verbosity:minimal
