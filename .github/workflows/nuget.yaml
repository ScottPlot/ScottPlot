name: Publish on NuGet

on:
  workflow_dispatch:
  release:
    types:
      - created

jobs:
  publish:
    runs-on: windows-latest
    name: Build and Publish
    steps:
      - name: ğŸ›’ Checkout
        uses: actions/checkout@v2
      - name: ğŸ¢ Set up MSBuild
        uses: microsoft/setup-msbuild@v1.0.3
      - name: âœ¨ Set up .NET 5.0
        uses: actions/setup-dotnet@v1
        with:
          dotnet-version: "5.0.x"
      - name: ğŸšš Restore
        working-directory: src
        run: dotnet restore
      - name: ğŸ“¦ ScottPlot
        run: dotnet pack src/ScottPlot/ScottPlot.csproj --configuration Release
      - name: ğŸ“¦ ScottPlot.WinForms
        run: dotnet pack src/controls/ScottPlot.WinForms/ScottPlot.WinForms.NUGET.csproj --configuration Release
      - name: ğŸ“¦ ScottPlot.WPF
        run: dotnet pack src/controls/ScottPlot.WPF/ScottPlot.WPF.NUGET.csproj --configuration Release
      - name: ğŸ“¦ ScottPlot.Avalonia
        # Avalonia control requires package to be made at build time
        run: dotnet build src/controls/ScottPlot.Avalonia/ScottPlot.Avalonia.NUGET.csproj --configuration Release
      - name: ğŸš€ Publish Packages
        run: |
          nuget push src/ScottPlot/bin/Release/*.nupkg --skip-duplicate
          nuget push src/controls/ScottPlot.WinForms/bin/Release/*.nupkg --skip-duplicate
          nuget push src/controls/ScottPlot.WPF/bin/Release/*.nupkg --skip-duplicate
          nuget push src/controls/ScottPlot.Avalonia/bin/Release/*.nupkg --skip-duplicate
